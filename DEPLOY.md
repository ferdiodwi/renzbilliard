# üöÄ Deployment Guide - Render.com + External MySQL

Complete step-by-step guide to deploy RenzBilliard to Render.com with external MySQL database.

---

## üìã Prerequisites

- [x] GitHub account
- [x] Render.com account (free)
- [x] External MySQL database (we'll set this up)
- [x] Git installed locally

---

## Part 1: Setup External MySQL Database

### Option A: PlanetScale (RECOMMENDED) ‚≠ê

**Why PlanetScale?**
- ‚úÖ 5GB free storage
- ‚úÖ Fast & reliable
- ‚úÖ Easy setup
- ‚úÖ Built-in backups

**Setup Steps:**

1. **Sign up**: Go to https://planetscale.com
2. **Create database**:
   - Click "New database"
   - Name: `renz-billiard`
   - Region: Choose closest to you
   - Plan: Free (Hobby)

3. **Get connection details**:
   ```
   Click "Connect" ‚Üí Select "Laravel" ‚Üí Copy credentials
   
   Host: aws.connect.psdb.cloud
   Database: renz-billiard
   Username: <generated>
   Password: <generated>
   Port: 3306
   ```

4. **Save credentials** - You'll need these for Render!

---

### Option B: db4free.net (Alternative)

**Free but slower, good for testing**

1. Go to https://www.db4free.net/signup.php
2. Fill registration form:
   - Database name: `renz_billiard` (max 16 chars, no special chars)
   - Username: Your choice
   - Password: Your choice
   - Email: Your email

3. Verify email and activate

4. **Connection details**:
   ```
   Host: db4free.net
   Port: 3306
   Database: renz_billiard
   Username: <your-username>
   Password: <your-password>
   ```

---

### Option C: FreeSQLDatabase.com

**Very limited (5MB), only for tiny testing**

1. Go to https://www.freesqldatabase.com
2. Sign up for free account
3. Create database
4. Get credentials from dashboard

‚ö†Ô∏è **Not recommended for production due to 5MB limit!**

---

## Part 2: Prepare Your Code

### 1. Update GitHub Repository

```bash
cd /home/ferdiodwi/Documents/RenzBilliard

# Make sure all changes are committed
git status

# Add new deployment files
git add render.yaml Dockerfile build.sh .env.render
git commit -m "Add Render deployment configuration"

# Push to GitHub
git push origin main
```

### 2. Update `.gitignore` (if needed)

Make sure `.env.render` is NOT ignored (it's a template, safe to commit):

```bash
# Check .gitignore
cat .gitignore | grep ".env"

# Should ignore .env but NOT .env.render
```

### 3. Make build.sh executable

```bash
chmod +x build.sh
git add build.sh
git commit -m "Make build script executable"
git push
```

---

## Part 3: Deploy to Render

### 1. Create Render Account

1. Go to https://render.com
2. Sign up with GitHub
3. Authorize Render to access your repositories

### 2. Create New Web Service

1. **Dashboard** ‚Üí Click "New +" ‚Üí "Web Service"

2. **Connect Repository**:
   - Find `renz-billiard` repository
   - Click "Connect"

3. **Configure Service**:
   ```
   Name: renz-billiard
   Region: Choose closest to you (Singapore/US)
   Branch: main
   Runtime: Docker
   ```

4. **Build & Deploy Settings**:
   - ‚úÖ Auto-detected from `render.yaml`
   - Build Command: `chmod +x ./build.sh && ./build.sh`
   - Start Command: `php artisan serve --host=0.0.0.0 --port=$PORT`

### 3. Set Environment Variables

In Render dashboard, go to **Environment** tab and add:

```env
APP_NAME=RenzBilliard
APP_ENV=production
APP_DEBUG=false
APP_URL=https://renz-billiard.onrender.com

# MySQL - Use YOUR credentials from Part 1
DB_CONNECTION=mysql
DB_HOST=<your-mysql-host>
DB_PORT=3306
DB_DATABASE=<your-database>
DB_USERNAME=<your-username>
DB_PASSWORD=<your-password>

CACHE_DRIVER=database
SESSION_DRIVER=database
SESSION_LIFETIME=120
LOG_CHANNEL=stack
```

**Important:**
- ‚ö†Ô∏è Replace `<your-mysql-host>` etc. with real credentials from Part 1
- ‚ö†Ô∏è `APP_KEY` will be auto-generated by Render

### 4. Deploy!

1. Click **"Create Web Service"**
2. Wait for deployment (5-10 minutes first time)
3. Monitor logs in "Logs" tab

---

## Part 4: Post-Deployment

### 1. Import Database Schema

Since external MySQL is used, you need to import schema manually:

**Option 1: Using Migration URL (if using PlanetScale)**
```bash
# From local machine
export DATABASE_URL="mysql://user:pass@host/db"
php artisan migrate --force
php artisan db:seed --force
```

**Option 2: Export/Import SQL**
```bash
# Export local database
mysqldump -u root -p renz_billiard > database.sql

# Import to external MySQL (use phpMyAdmin or command line)
mysql -h <external-host> -u <user> -p <database> < database.sql
```

### 2. Test Application

Visit: `https://renz-billiard.onrender.com`

**Test checklist:**
- [ ] Homepage loads
- [ ] Can login (admin@renzbilliard.com / password)
- [ ] Dashboard shows data
- [ ] Tables page works
- [ ] POS system works
- [ ] Alerts work
- [ ] Mobile responsive

### 3. Update APP_URL

After deployment, update `APP_URL` in Render environment variables with your actual URL:

```env
APP_URL=https://renz-billiard.onrender.com
```

Then redeploy (Manual Deploy ‚Üí "Clear build cache & deploy")

---

## üîß Troubleshooting

### Build Failed

**Check logs:**
1. Go to "Logs" tab
2. Look for error messages
3. Common issues:
   - Missing `APP_KEY` ‚Üí Will be auto-generated
   - Database connection failed ‚Üí Check MySQL credentials
   - npm build failed ‚Üí Check `package.json`

### Database Connection Error

```
SQLSTATE[HY000] [2002] Connection refused
```

**Solutions:**
1. Verify MySQL host allows remote connections
2. Check firewall rules on MySQL hosting
3. Verify credentials are correct
4. For PlanetScale: Make sure database is not sleeping

### Assets Not Loading

**Issue:** CSS/JS not loading

**Solution:**
```bash
# In Render shell or rebuild
php artisan storage:link
npm run build
php artisan config:clear
```

### Cold Start Delay

**Issue:** First request after idle takes 30+ seconds

**This is normal on Render free tier!**
- Server sleeps after 15 minutes of inactivity
- Cold start time: ~30 seconds
- Subsequent requests: Fast

---

## üéØ Performance Optimization

### 1. Enable Route Caching

Already done in `build.sh`:
```bash
php artisan route:cache
php artisan config:cache
php artisan view:cache
```

### 2. Optimize Images

Upload optimized images to `/public/images/`

### 3. Consider CDN (Optional)

For static assets, use Cloudflare CDN (free)

---

## üîÑ Continuous Deployment

**Auto-deploy on Git push:**

1. In Render dashboard ‚Üí Settings
2. Enable "Auto-Deploy" ‚Üí YES
3. Now every `git push` will trigger deployment!

```bash
# Make changes
git add .
git commit -m "Update feature"
git push

# Render auto-deploys! üöÄ
```

---

## üí∞ Cost Breakdown

| Service | Cost | Notes |
|---------|------|-------|
| Render Web Service | FREE | 750 hours/month (25 days) |
| PlanetScale MySQL | FREE | 5GB storage, 1B rows |
| **TOTAL** | **$0/month** | 100% Free! |

**Limitations:**
- ‚ö†Ô∏è Server sleeps after 15 min idle
- ‚ö†Ô∏è 750 hours/month (use paid if 24/7 needed)
- ‚ö†Ô∏è Limited build minutes

---

## üìû Support

**Render Support:**
- Docs: https://render.com/docs
- Community: https://community.render.com

**MySQL Issues:**
- PlanetScale: https://docs.planetscale.com
- db4free: https://www.db4free.net/

**Application Issues:**
- Check logs in Render dashboard
- Test locally first: `php artisan serve`

---

## üéâ You're Live!

Your RenzBilliard app is now deployed at:
**https://renz-billiard.onrender.com**

Share with your team and start managing billiard sessions! üé±

---

**Next Steps:**
1. [ ] Custom domain (optional)
2. [ ] SSL certificate (auto on Render)
3. [ ] Monitoring & analytics
4. [ ] Backup strategy for database
